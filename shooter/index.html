<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pew Pew Game</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; color: white; font-family: sans-serif; }
        canvas { display: block; }
        #ui {
            position: absolute;
            top: 10px;
            left: 10px;
            pointer-events: none;
            user-select: none;
        }
        #controls { font-size: 0.8em; margin-top: 10px; }
        #home-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #e67e22;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            z-index: 100;
        }
        #home-btn:hover { background: #d35400; }
    </style>
</head>
<body>
    <button id="home-btn" onclick="location.href='../index.html'">Back to Home</button>
    <div id="ui">
        <div>Score: <span id="score">0</span></div>
        <div>Current Projectile: <span id="colorName">Red</span></div>
        <div id="controls">
            [1] Red [2] Green [3] Blue | Arrows to Move | Space to Shoot
        </div>
    </div>
    <canvas id="gameCanvas"></canvas>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score');
        const colorNameEl = document.getElementById('colorName');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const COLORS = [
            { name: 'Red', value: '#ff4444' },
            { name: 'Green', value: '#44ff44' },
            { name: 'Blue', value: '#4444ff' }
        ];

        let score = 0;
        let currentColorIndex = 0;

        const playerImg = new Image();
        playerImg.src = 'OIP.webp';

        class Player {
            constructor() {
                this.width = 50;
                this.height = 50;
                this.x = canvas.width / 2 - this.width / 2;
                this.y = canvas.height - 80;
                this.speed = 7;
            }

            draw() {
                if (playerImg.complete && playerImg.naturalWidth !== 0) {
                    ctx.drawImage(playerImg, this.x, this.y, this.width, this.height);
                } else {
                    ctx.fillStyle = 'white';
                    ctx.fillRect(this.x, this.y, this.width, this.height);
                }
                
                ctx.strokeStyle = COLORS[currentColorIndex].value;
                ctx.lineWidth = 3;
                ctx.strokeRect(this.x - 2, this.y - 2, this.width + 4, this.height + 4);
            }

            update(keys) {
                if (keys['ArrowLeft'] && this.x > 0) this.x -= this.speed;
                if (keys['ArrowRight'] && this.x < canvas.width - this.width) this.x += this.speed;
            }
        }

        class Projectile {
            constructor(x, y, colorIndex) {
                this.x = x;
                this.y = y;
                this.radius = 5;
                this.colorIndex = colorIndex;
                this.color = COLORS[colorIndex].value;
                this.speed = 10;
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.closePath();
            }

            update() {
                this.y -= this.speed;
            }
        }

        class Enemy {
            constructor(x, y, colorIndex) {
                this.x = x;
                this.y = y;
                this.width = 40;
                this.height = 40;
                this.colorIndex = colorIndex;
                this.color = COLORS[colorIndex].value;
            }

            draw() {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.width, this.height);
                ctx.fillStyle = 'black';
                ctx.fillRect(this.x + 5, this.y + 10, 8, 8);
                ctx.fillRect(this.x + this.width - 13, this.y + 10, 8, 8);
            }
        }

        const player = new Player();
        const projectiles = [];
        let enemies = [];
        const keys = {};

        const rows = 3;
        const cols = 8;
        let enemyDirection = 1;
        let enemySpeed = 2;

        function initEnemies() {
            enemies = [];
            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    const colorIdx = Math.floor(Math.random() * COLORS.length);
                    enemies.push(new Enemy(c * 60 + 50, r * 60 + 50, colorIdx));
                }
            }
        }

        initEnemies();

        window.addEventListener('keydown', (e) => {
            keys[e.code] = true;
            if (e.code === 'Digit1') currentColorIndex = 0;
            if (e.code === 'Digit2') currentColorIndex = 1;
            if (e.code === 'Digit3') currentColorIndex = 2;
            colorNameEl.textContent = COLORS[currentColorIndex].name;
            colorNameEl.style.color = COLORS[currentColorIndex].value;

            if (e.code === 'Space') {
                projectiles.push(new Projectile(player.x + player.width / 2, player.y, currentColorIndex));
            }
        });

        window.addEventListener('keyup', (e) => {
            keys[e.code] = false;
        });

        function animate() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            player.update(keys);
            player.draw();

            for (let i = projectiles.length - 1; i >= 0; i--) {
                const p = projectiles[i];
                p.update();
                p.draw();

                if (p.y < 0) {
                    projectiles.splice(i, 1);
                    continue;
                }

                for (let j = enemies.length - 1; j >= 0; j--) {
                    const e = enemies[j];
                    if (p.x > e.x && p.x < e.x + e.width &&
                        p.y > e.y && p.y < e.y + e.height) {
                        
                        if (p.colorIndex === e.colorIndex) {
                            enemies.splice(j, 1);
                            projectiles.splice(i, 1);
                            score += 10;
                            scoreEl.textContent = score;
                        } else {
                            projectiles.splice(i, 1);
                        }
                        break;
                    }
                }
            }

            let hitWall = false;
            enemies.forEach(e => {
                e.x += enemySpeed * enemyDirection;
                e.draw();
                if (e.x + e.width > canvas.width || e.x < 0) hitWall = true;
                
                if (e.y + e.height > player.y) {
                    alert('Game Over! Score: ' + score);
                    score = 0;
                    scoreEl.textContent = '0';
                    initEnemies();
                }
            });

            if (hitWall) {
                enemyDirection *= -1;
                enemies.forEach(e => e.y += 20);
            }

            if (enemies.length === 0) {
                enemySpeed += 0.5;
                initEnemies();
            }

            requestAnimationFrame(animate);
        }

        animate();
    </script>
</body>
</html>
